<!doctype html>
<html lang=cmn-Hans>
<head>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name=format-detection content="telephone=no">
  <link rel=stylesheet href="/bootstrap-lnn/dist/bootstrap-lnn.min.css">
  <link rel=stylesheet href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" crossorigin=anonymous>
  <link rel=stylesheet href="/blog/css/common.css">
  <link rel=stylesheet href="/blog/css/rouge-syntax.css">
  
  <link rel=icon href="/site_icon.png">
  <link rel="shortcut icon" href="/site_icon.png">
  <link rel=apple-touch-icon href="/site_icon.png" sizes="160x160">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>再谈自产生程序 | LNN的博客！</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="再谈自产生程序" />
<meta name="author" content="DGCK81LNN" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="再谈自产生程序 之前那篇关于自产生程序的博客表述不清，现决定重新讲解一下。 这里的“自产生程序”是指输出自身源代码的程序。自产生程序有几种不同的思路，而我使用的这种思路可以类比为……“噬菌体”。 我们知道，噬菌体是一种简单的病毒，它专门感染细菌，在结构上由蛋白质外壳和遗传物质（一般是DNA）组成。这些遗传物质记录了整个蛋白质外壳的内容，而在蛋白质外壳的帮助下，噬菌体才能去感染细菌，并生产出新的DNA和蛋白质外壳，从而繁殖出新的噬菌体。" />
<meta property="og:description" content="再谈自产生程序 之前那篇关于自产生程序的博客表述不清，现决定重新讲解一下。 这里的“自产生程序”是指输出自身源代码的程序。自产生程序有几种不同的思路，而我使用的这种思路可以类比为……“噬菌体”。 我们知道，噬菌体是一种简单的病毒，它专门感染细菌，在结构上由蛋白质外壳和遗传物质（一般是DNA）组成。这些遗传物质记录了整个蛋白质外壳的内容，而在蛋白质外壳的帮助下，噬菌体才能去感染细菌，并生产出新的DNA和蛋白质外壳，从而繁殖出新的噬菌体。" />
<link rel="canonical" href="https://dgck81lnn.github.io/blog/posts/210409_phage_quine" />
<meta property="og:url" content="https://dgck81lnn.github.io/blog/posts/210409_phage_quine" />
<meta property="og:site_name" content="LNN的博客！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-09T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="再谈自产生程序" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"DGCK81LNN","url":"https://github.com/DGCK81LNN"},"dateModified":"2021-04-09T00:00:00+08:00","datePublished":"2021-04-09T00:00:00+08:00","description":"再谈自产生程序 之前那篇关于自产生程序的博客表述不清，现决定重新讲解一下。 这里的“自产生程序”是指输出自身源代码的程序。自产生程序有几种不同的思路，而我使用的这种思路可以类比为……“噬菌体”。 我们知道，噬菌体是一种简单的病毒，它专门感染细菌，在结构上由蛋白质外壳和遗传物质（一般是DNA）组成。这些遗传物质记录了整个蛋白质外壳的内容，而在蛋白质外壳的帮助下，噬菌体才能去感染细菌，并生产出新的DNA和蛋白质外壳，从而繁殖出新的噬菌体。","headline":"再谈自产生程序","mainEntityOfPage":{"@type":"WebPage","@id":"https://dgck81lnn.github.io/blog/posts/210409_phage_quine"},"url":"https://dgck81lnn.github.io/blog/posts/210409_phage_quine"}</script>
<!-- End Jekyll SEO tag -->

  
  <script defer crossorigin=anonymous
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"
  ></script>
  <script defer src="/blog/js/common.js"></script>
  
</head>

<body>
  <div class="visually-hidden-focusable position-absolute top-0 start-0 p-1 bg-light">
    <a href="#main">跳至正文</a>
  </div>

  <header class="d-flex justify-content-center py-3 mb-4 border-bottom shadow-sm bg-light">
    <span>LNN的博客！</span>
  </header>

  <div id="mainwrap">
    <nav id=nav>
      <ol class="breadcrumb bg-light rounded p-3">
        <li class="breadcrumb-item"><a href="/blog">LNN的博客！</a></li>
        <li class="breadcrumb-item active" aria-current="page">再谈自产生程序</li>
      </ol>
    </nav>

    <main id=main>
<footer>
  <p class="text-muted">
    <a href="https://github.com/DGCK81LNN"
      >DGCK81LNN</a>
    &middot;
    <time datetime="2021-04-09T00:00:00+0800">2021-04-09</time>
      &middot;
      <span><span class=visually-hidden>标签：</span>
      <a href="/blog/tags/coding" class="text-decoration-none">
        <span class="badge bg-primary">编程</span>
      </a>
      <a href="/blog/tags/everyday-coding" class="text-decoration-none">
        <span class="badge bg-secondary">日常写代码</span>
      </a>
      </span>
  </p>
</footer>

<div class="soulblog-content">
<h1 id="再谈自产生程序">再谈自产生程序</h1>

<p><a href="/blog/posts/210115_quines">之前那篇</a>关于自产生程序的博客表述不清，现决定重新讲解一下。</p>

<p>这里的“自产生程序”是指输出自身源代码的程序。自产生程序有几种不同的思路，而我使用的这种思路可以类比为……“噬菌体”。</p>

<p>我们知道，噬菌体是一种简单的病毒，它专门感染细菌，在结构上由蛋白质外壳和遗传物质（一般是DNA）组成。这些遗传物质记录了整个蛋白质外壳的内容，而在蛋白质外壳的帮助下，噬菌体才能去感染细菌，并生产出新的DNA和蛋白质外壳，从而繁殖出新的噬菌体。</p>

<p>我们的自产生程序就像是噬菌体。当噬菌体感染了一个宿主细菌，细菌会复制噬菌体的DNA，同时根据这个DNA制作出新的蛋白质外壳，然后外壳和DNA组装成新的噬菌体。在自产生程序的代码中硬编码了一些数据（DNA），数据记录了源代码中其余的部分（蛋白质外壳）；程序根据“DNA”得到“蛋白质外壳”，然后把“DNA”安在“蛋白质外壳”中正确的位置，从而输出自己的源代码。</p>

<p>请看以下Python代码：</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dna</span> <span class="o">=</span> <span class="sh">'</span><span class="s">dna = %r</span><span class="se">\n</span><span class="s">print(dna %% dna)</span><span class="sh">'</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dna</span> <span class="o">%</span> <span class="n">dna</span><span class="p">)</span>
</code></pre></div></div>

<p>第一行代码中的字符串即是“DNA”，其余代码则是“蛋白质外壳”。可以看到，“DNA”字符串的内容就是整个程序源代码，只是字符串本身的位置变成了<code class="language-plaintext highlighter-rouge">%r</code>。在Python和一些其他语言中，对字符串使用模运算符<code class="language-plaintext highlighter-rouge">%</code>会进行文本格式化。这里，<code class="language-plaintext highlighter-rouge">dna % dna</code>会把<code class="language-plaintext highlighter-rouge">dna</code>字符串源代码塞到<code class="language-plaintext highlighter-rouge">dna</code>中<code class="language-plaintext highlighter-rouge">%r</code>的位置上，也就是把DNA组装到了蛋白质外壳里。<code class="language-plaintext highlighter-rouge">%%</code>是转义的<code class="language-plaintext highlighter-rouge">%</code>。</p>

<p>Ruby没有<code class="language-plaintext highlighter-rouge">%r</code>，可用<code class="language-plaintext highlighter-rouge">dna % dna.inspect</code>代替：</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dna</span> <span class="o">=</span> <span class="s2">"dna = %s</span><span class="se">\n</span><span class="s2">puts dna %% dna.inspect"</span>
<span class="nb">puts</span> <span class="n">dna</span> <span class="o">%</span> <span class="n">dna</span><span class="p">.</span><span class="nf">inspect</span>
</code></pre></div></div>

<p>这个JavaScript实现也是大同小异，只是JS没有文本格式化：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">dna</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">var dna = $1;</span><span class="se">\n</span><span class="s2">console.log(dna.replace('$1', JSON.stringify(dna)));</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">dna</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">$1</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">dna</span><span class="p">)));</span>
</code></pre></div></div>

<p>JS中用<code class="language-plaintext highlighter-rouge">JSON.stringify()</code>可以达到跟<code class="language-plaintext highlighter-rouge"> dna.inspect</code>类似的效果，而<code class="language-plaintext highlighter-rouge">.replace()</code>则代替<code class="language-plaintext highlighter-rouge">%</code>运算符，把转义后的字符串塞到第一个<code class="language-plaintext highlighter-rouge">$1</code>的位置上。</p>

<p>这一次我也成功写出了之前没能实现的C语言版：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="kt">char</span> <span class="o">*</span><span class="n">dna</span> <span class="o">=</span> 
<span class="s">"#include &lt;stdio.h&gt;</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"char *dna = </span><span class="se">\n</span><span class="s">"</span>
<span class="s">"</span><span class="se">\32</span><span class="s">;</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"int main() {</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"  for (int i = 0; dna[i]; ++i) {</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"    if (dna[i] == 032) { // placeholder</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"      putchar(34); // quote</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"      for (int j = 0; dna[j]; ++j) {</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"        if (dna[j] == 032) { // placeholder</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"          putchar(92); putchar(51); putchar(50); // backslash 32</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"        } else if (dna[j] == 10) { // newline</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"          putchar(92); putchar(110); putchar(34); putchar(10); // backslash n quote newline</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"          putchar(34); // quote</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"        } else putchar(dna[j]);</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"      }</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"      putchar(34); // quote</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"    }</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"    else putchar(dna[i]);</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"  }</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"  putchar(10); // newline</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"  return 0;</span><span class="se">\n</span><span class="s">"</span>
<span class="s">"}"</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dna</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dna</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mo">032</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// placeholder</span>
      <span class="n">putchar</span><span class="p">(</span><span class="mi">34</span><span class="p">);</span> <span class="c1">// quote</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dna</span><span class="p">[</span><span class="n">j</span><span class="p">];</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dna</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mo">032</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// placeholder</span>
          <span class="n">putchar</span><span class="p">(</span><span class="mi">92</span><span class="p">);</span> <span class="n">putchar</span><span class="p">(</span><span class="mi">51</span><span class="p">);</span> <span class="n">putchar</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span> <span class="c1">// backslash 32</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dna</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// newline</span>
          <span class="n">putchar</span><span class="p">(</span><span class="mi">92</span><span class="p">);</span> <span class="n">putchar</span><span class="p">(</span><span class="mi">110</span><span class="p">);</span> <span class="n">putchar</span><span class="p">(</span><span class="mi">34</span><span class="p">);</span> <span class="n">putchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// backslash n quote newline</span>
          <span class="n">putchar</span><span class="p">(</span><span class="mi">34</span><span class="p">);</span> <span class="c1">// quote</span>
        <span class="p">}</span> <span class="k">else</span> <span class="n">putchar</span><span class="p">(</span><span class="n">dna</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="n">putchar</span><span class="p">(</span><span class="mi">34</span><span class="p">);</span> <span class="c1">// quote</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="n">putchar</span><span class="p">(</span><span class="n">dna</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">putchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="c1">// newline</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>这段代码看起来与前面三个例子相去甚远，但总体思路是完全一样的，只是“把字符串变回字符串的源代码”和“把字符串的源代码塞进‘蛋白质外壳’”这两件事需要手动进行。</p>

<p>使用<code class="language-plaintext highlighter-rouge">putchar()</code>纯粹是为了避免向“DNA”中引入引号和反斜杠，这样我就只需要转义换行符了。使用了<code class="language-plaintext highlighter-rouge">'\32'</code>作为在“蛋白质外壳”中为“DNA”预留位置的占位符，注意它和数字<code class="language-plaintext highlighter-rouge">032</code>都是八进制。</p>

<hr />

<p>如果亲自尝试按这种思路编写自产生程序，不难发现，“DNA”是最后写进去的，因为它的内容是程序其余部分的代码。如果要对局部代码进行一些小修改，我会直接修改“DNA”，然后运行程序，得到的“子一代”的“蛋白质外壳”就也变成了修改后的版本。这让我想起生物课上讲的“基因突变”。事实上，我正是在生物课上讲“DNA的复制”时想出本文反复提到的“噬菌体模型”的。<del>我真后悔六选三没选生物而选了地理</del> 竟然能从大自然的创造中获得计算机编程的灵感，多么奇妙啊！</p>

<div class="card my-3">
  <div class="card-header">2021-04-24 EDIT</div>
  <div class="card-body">
    <p class="card-text">我把地理换成生物了（六选三科目），好耶！</p>
  </div>
</div>

</div>

<hr>

<section>
  <h2>评论区</h2>
  <script defer src="https://utteranc.es/client.js" crossorigin=anonymous
    data-theme=github-light
    data-repo="DGCK81LNN/blog" data-label="utterances comments"
    data-issue-term="/posts/210409_phage_quine"
  ></script>
  <div class="soulblog-utterances-placeholder d-flex flex-column justify-content-center align-items-center">
    <div class="spinner-border text-primary" role=status></div>
    <p class="text-muted mt-3">
      加载基于 GitHub issues 的 <a href="https://utteranc.es/" crossorigin=anonymous>utteranc.es</a> 评论区组件……
    </p>
  </div>
</section>

    </main>
  </div>

  <footer class="mt-4 px-2 py-4 bg-light border-top">
    <div id=footer class="mx-auto">
      <div class="mb-2 d-flex gap-2 justify-content-between align-items-center flex-wrap">
        <div>
          <a class="d-block"
            href="https://github.com/DGCK81LNN/blog/blob/main/_posts/2021-04-09-phage_quine.md?plain=1">
            <img class="d-block" alt="在GitHub上查看源代码"
              src="https://img.shields.io/badge/-在GitHub上查看源代码-222222?logo=github" />
          </a>
        </div>
        <div class="d-flex gap-2 align-items-center flex-wrap">
          <a class="d-block" href="https://notbyai.fyi" lang="en">
            <img class="d-block" alt="written by human, not by AI"
              src="/blog/assets/Written-By-Human-Not-By-AI-Badge-white.svg"/>
          </a>
          <a class="d-block" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans">
            <img class="d-block" alt="CC BY-SA"
              src="/blog/assets/by-sa.svg"/>
          </a>
        </div>
      </div>
      <div class="text-secondary mb-2">
        <p>本站图文内容除另有声明外，均在<a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh-hans"
          >知识共享 署名-相同方式共享 4.0 国际（CC BY-SA 4.0）许可协议</a
          >下发布。</p>
      </div>
      <div class="d-flex flex-wrap mb-0">
        <a href="/">灵魂小站首页</a>
        <span class="mx-2 vr"></span>
        <a rel=nofollow href="https://github.com/DGCK81LNN/">我的 GitHub</a>
        <span class="mx-2 vr"></span>
        <span>QQ: 3470524928</span>
      </div>
    </div>
  </footer>
</body>
</html>
<!------------------------------------------------------------------------------
  page:
    path: "_posts/2021-04-09-phage_quine.md"
    dir: null
    name: "2021-04-09-phage_quine.md"
    url: "/posts/210409_phage_quine"
    collection: "posts"
    layout: "posts"
------------------------------------------------------------------------------->
