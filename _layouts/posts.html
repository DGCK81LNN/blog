---
layout: base
---
<footer>
  <p class="text-muted">
    <a href="{{ page.author.url | default: site.author.url | escape }}"
      >{{ page.author.name | default: site.author.name }}</a>
    &middot;
    <time datetime="{{ page.date | date: '%FT%T%z' }}">
      {%- assign daytime = page.date | date: "%T" -%}
      {%- if daytime == "00:00:00" -%}
      {{- page.date | date: "%F" -}}
      {%- else -%}
      {{- page.date | date: "%F %H:%M" -}}
      {%- endif -%}
    </time>
    {%- if page.last_modified_at %}
    &middot;
    <span>最后更新于 <time datetime="{{ page.last_modified_at | date: '%FT%T%z' }}"
    >{{ page.last_modified_at | date: "%F %H:%M" }}</time
    ></span>
    {%- endif %}
    {%- if page.tags != empty %}
      &middot;
      <span><span class=visually-hidden>标签：</span>
      {%- for tag in page.tags %}
      {%- assign tagdef = site.data.tags | find: 'name', tag %}
      <a href="{{ site.baseurl }}/tags/{{ tagdef.slug }}" class="text-decoration-none">
        <span class="badge bg-{{ tagdef.color | default: 'secondary' }}">{{ tag }}</span>
      </a>
      {%- endfor %}
      </span>
    {%- endif %}
  </p>
</footer>

<div class="soulblog-content"
{%- if page.lang %} lang="{{ page.lang }}" {%- endif -%}
>
{{ content }}
</div>

<hr>

<section>
  <h2>评论区</h2>
  {%- assign comments = site.data.comments | where: 'post_url', page.url %}
  {%- for comment in comments %}
  {%- capture avatar -%}
    https://gravatar.loli.net/avatar/
      {%- if comment.email_hash -%}
        {{ comment.email_hash }}?d=identicon
      {%- elsif comment.email -%}
        {{ comment.email | downcase | soulblog_md5 }}?d=identicon
      {%- else -%}
        ?f=y&d=mp
    {%- endif %}
  {%- endcapture %}
  <article class="comment card p-2 pb-0 mb-2">
    <footer class="d-flex mb-3">
      <div class="me-1 align-self-stretch">
        <img class="border rounded" width=80 height=80 crossorigin=anonymous
             src="{{ avatar }}" style="width:40px;height:40px">
      </div>
      <div class="flex-fill align-self-center">
        {%- if comment.homepage %}
        <a rel=nofollow crossorigin=anonymous
           href="{{ comment.homepage | escape }}"
        >{{ comment.nickname }}</a>
        {%- else %}
        {{ comment.nickname }}
        {%- endif %}
        {%- if comment.email %}
        ({{ comment.email | soulblog_emailsub }})
        {%- endif %}
        <span class="text-muted">{{ comment.date | date: "%Y-%m-%d" }}</span>
      </div>
    </footer>
    {{ comment.content | markdownify }}
    {%- if comment.reply %}
    <article class="ms-4">
      <header><h6>博主回复</h6></header>
      {{ comment.reply | markdownify }}
    </article>
    {%- endif %}
  </article>
  {%- endfor %}
  <div>
    <a target=_blank
      href="{{ site.soulblog-comment-url }}?q1={{ site.url }}{{ site.baseurl }}{{ page.url }}"
    >发表评论…</a>
  </div>
</section>
